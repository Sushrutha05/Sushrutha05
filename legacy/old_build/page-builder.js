/**
 * Modular Page Builder
 * Generates HTML pages from components and configuration
 */

const fs = require('fs');
const path = require('path');

class PageBuilder {
    constructor() {
        this.config = require('../config/site-config.js');
        this.componentsDir = path.join(__dirname, '../components');
        this.outputDir = path.join(__dirname, '../');
        this.components = {};
        
        // Load all components
        this.loadComponents();
    }

    /**
     * Load all component templates
     */
    loadComponents() {
        const componentFiles = fs.readdirSync(this.componentsDir);
        
        componentFiles.forEach(file => {
            if (file.endsWith('.html')) {
                const componentName = file.replace('.html', '');
                const componentPath = path.join(this.componentsDir, file);
                this.components[componentName] = fs.readFileSync(componentPath, 'utf8');
            }
        });
    }

    /**
     * Replace template variables with actual values
     */
    replaceVariables(template, variables) {
        let result = template;
        
        Object.entries(variables).forEach(([key, value]) => {
            const regex = new RegExp(`{{${key}}}`, 'g');
            result = result.replace(regex, value || '');
        });
        
        return result;
    }

    /**
     * Generate meta tags for a page
     */
    generateMetaTags(pageConfig) {
        const variables = {
            PAGE_TITLE: pageConfig.title,
            PAGE_DESCRIPTION: pageConfig.description,
            PAGE_KEYWORDS: pageConfig.keywords || this.config.seo.keywords,
            PAGE_URL: pageConfig.url,
            SITE_AUTHOR: this.config.site.name,
            SITE_URL: this.config.site.url,
            OG_IMAGE: pageConfig.image || this.config.seo.defaultImage
        };

        return this.replaceVariables(this.components['meta-tags'], variables);
    }

    /**
     * Build a complete page
     */
    buildPage(pageConfig) {
        const metaTags = this.generateMetaTags(pageConfig);
        
        const variables = {
            META_TAGS: metaTags,
            HEADER: this.components['header'],
            FOOTER: this.components['footer'],
            CONTENT: pageConfig.content,
            LAYOUT_CLASS: pageConfig.layoutClass || '',
            MAIN_CLASS: pageConfig.mainClass || 'container mx-auto px-6'
        };

        return this.replaceVariables(this.components['base-layout'], variables);
    }

    /**
     * Generate Home Page
     */
    generateHomePage() {
        const aboutSection = `
            <section id="about" class="py-20 lg:py-32">
                <div class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-12 items-start">
                    <div class="md:col-span-1 scroll-reveal">
                        <img src="headshot.png" alt="Sushrutha Portrait" class="rounded-full aspect-square object-cover shadow-2xl shadow-indigo-900/50">
                    </div>
                    <div class="md:col-span-2">
                        <div class="scroll-reveal glass-card p-8 rounded-xl">
                            <h2 class="text-scramble text-3xl font-bold mb-4 gradient-text">About Me</h2>
                            <p class="text-gray-400 mb-4 leading-relaxed">
                                I am an engineering student passionate about building technology that blends software, hardware, and intelligence.
                            </p>
                            <p class="text-gray-400 mb-4 leading-relaxed">
                                My work ranges from real-time mobile applications to embedded systems, with projects in AI, networking, and human-computer interaction. I enjoy taking an idea from concept to execution ‚Äî designing clean, functional solutions that feel intuitive and purposeful.
                            </p>
                            <p class="text-gray-400 leading-relaxed">
                                For me, engineering is not just about solving problems, but about creating experiences that are precise, scalable, and meaningful.
                            </p>
                        </div>
                        ${this.components['skills-section']}
                    </div>
                </div>
            </section>
        `;

        const heroContent = `
            <section id="hero" class="min-h-screen flex flex-col justify-center items-center text-center relative">
                <div class="max-w-4xl scroll-reveal relative z-10">
                    <h1 id="hero-title" class="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter mb-6">
                        <!-- Content generated by JS -->
                    </h1>
                    <p class="text-lg md:text-xl text-gray-400 max-w-2xl mx-auto">
                        ${this.config.site.description}
                    </p>
                </div>
                <a href="#about" class="absolute bottom-10 animate-bounce z-10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                    </svg>
                </a>
            </section>
        `;

        const pageConfig = {
            title: `${this.config.site.name} - ${this.config.site.title}`,
            description: this.config.site.description,
            url: 'home.html',
            content: heroContent + aboutSection,
            layoutClass: '',
            mainClass: 'container mx-auto px-6'
        };

        return this.buildPage(pageConfig);
    }

    /**
     * Generate Work Page
     */
    generateWorkPage() {
        const content = `
            <div id="loading-indicator" class="container mx-auto px-6 pt-40 flex-grow flex items-center justify-center">
                <p class="text-gray-400">Fetching latest activity...</p>
            </div>

            <div id="content-wrapper" class="hidden">
                <section id="work" class="pt-40">
                    <div class="text-center mb-16 scroll-reveal">
                        <h2 class="text-4xl md:text-5xl font-bold tracking-tighter mb-4 gradient-text">Curated Works</h2>
                        <p class="text-lg text-gray-400 max-w-2xl mx-auto">A selection of projects that showcase my passion for building meaningful technology.</p>
                    </div>
                    ${this.components['projects-grid']}
                </section>

                <div data-component="stats" data-component-data='{"type": "work"}'></div>

                <section id="activity" class="mt-24">
                    <div class="text-center mb-16 scroll-reveal">
                        <h2 class="text-4xl md:text-5xl font-bold tracking-tighter mb-4 gradient-text">Latest Activity</h2>
                        <p class="text-lg text-gray-400 max-w-2xl mx-auto">A live feed of my recent public contributions and development work from GitHub.</p>
                    </div>
                    <div id="activity-list" class="max-w-3xl mx-auto space-y-4">
                        <!-- Activity items will be injected here by JavaScript -->
                    </div>
                </section>
            </div>
        `;

        const pageConfig = {
            title: `Projects & Work - ${this.config.site.name}`,
            description: 'Explore my curated projects and real-time development activity.',
            url: 'work.html',
            content: content,
            layoutClass: 'flex flex-col min-h-screen',
            mainClass: 'flex-grow'
        };

        return this.buildPage(pageConfig);
    }

    /**
     * Generate Certifications Page
     */
    generateCertificationsPage() {
        const content = `
            <section id="certifications" class="pt-40">
                <div class="text-center mb-16 scroll-reveal">
                    <h2 class="text-4xl md:text-5xl font-bold tracking-tighter mb-4 gradient-text">Certifications</h2>
                    <p class="text-lg text-gray-400 max-w-2xl mx-auto">Professional certifications and credentials that validate my technical expertise and commitment to continuous learning.</p>
                </div>

                ${this.components['certifications-grid']}

                <div class="text-center scroll-reveal" style="transition-delay: 800ms;">
                    <div class="glass-card p-8 rounded-2xl max-w-2xl mx-auto">
                        <h3 class="text-2xl font-bold text-white mb-6">Continuous Learning</h3>
                        <div class="grid grid-cols-3 gap-8">
                            <div>
                                <div class="text-3xl font-bold text-indigo-400 mb-2">8+</div>
                                <div class="text-gray-400 text-sm">Certifications</div>
                            </div>
                            <div>
                                <div class="text-3xl font-bold text-indigo-400 mb-2">2024</div>
                                <div class="text-gray-400 text-sm">Latest Year</div>
                            </div>
                            <div>
                                <div class="text-3xl font-bold text-indigo-400 mb-2">5</div>
                                <div class="text-gray-400 text-sm">Domains</div>
                            </div>
                        </div>
                        <p class="text-gray-400 mt-6 text-sm">Committed to staying current with emerging technologies and industry best practices through continuous professional development.</p>
                    </div>
                </div>
            </section>
        `;

        const pageConfig = {
            title: `Professional Certifications - ${this.config.site.name}`,
            description: 'Professional certifications and credentials validating technical expertise.',
            url: 'certifications.html',
            content: content,
            layoutClass: 'flex flex-col min-h-screen',
            mainClass: 'container mx-auto px-6 flex-grow'
        };

        return this.buildPage(pageConfig);
    }

    /**
     * Generate Contact Page
     */
    generateContactPage() {
        const content = `
            <section id="contact" class="pt-40 flex flex-col items-center justify-center h-full">
                <div class="text-center mb-16 scroll-reveal">
                    <h2 class="text-4xl md:text-5xl font-bold tracking-tighter mb-4 gradient-text">Let's Connect</h2>
                    <p class="text-lg text-gray-400 max-w-2xl mx-auto">I'm always open to discussing new projects, creative ideas, or opportunities to be part of an ambitious vision. Feel free to reach out.</p>
                </div>

                ${this.components['contact-methods']}

                <div class="w-full max-w-2xl scroll-reveal" style="transition-delay: 200ms;">
                    <div class="glass-card p-8 md:p-12 rounded-2xl">
                        <h3 class="text-2xl font-bold text-white mb-6 text-center">Send a Message</h3>
                        <form id="contact-form" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="name" class="block text-sm font-medium text-gray-300 mb-2">Name</label>
                                    <input type="text" id="name" name="name" required class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300" placeholder="Your name">
                                </div>
                                <div>
                                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                                    <input type="email" id="email" name="email" required class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300" placeholder="your@email.com">
                                </div>
                            </div>
                            <div>
                                <label for="subject" class="block text-sm font-medium text-gray-300 mb-2">Subject</label>
                                <input type="text" id="subject" name="subject" required class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300" placeholder="What's this about?">
                            </div>
                            <div>
                                <label for="message" class="block text-sm font-medium text-gray-300 mb-2">Message</label>
                                <textarea id="message" name="message" rows="5" required class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 resize-none" placeholder="Tell me about your project or idea..."></textarea>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                                <button type="submit" id="submit-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-medium py-3 px-8 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <span class="submit-text">Send Message</span>
                                    <span class="loading-text hidden">Sending...</span>
                                </button>
                                <a href="mailto:${this.config.site.email}" class="bg-white/10 border border-white/20 hover:bg-white/20 text-white font-medium py-3 px-8 rounded-lg transition-all duration-300 text-center">
                                    Direct Email
                                </a>
                            </div>
                        </form>
                        <div id="form-message" class="mt-4 text-center hidden"></div>
                    </div>
                </div>

                <div class="w-full max-w-2xl scroll-reveal mt-8" style="transition-delay: 300ms;">
                    <div class="glass-card p-6 rounded-xl text-center">
                        <p class="text-gray-400 mb-4">Prefer a direct approach?</p>
                        <a href="mailto:${this.config.site.email}" class="text-xl text-indigo-300 hover:text-indigo-200 transition-colors duration-300 font-mono">
                            ${this.config.site.email}
                        </a>
                    </div>
                </div>
            </section>
        `;

        const pageConfig = {
            title: `Contact & Collaboration - ${this.config.site.name}`,
            description: 'Get in touch for project collaborations and technical discussions.',
            url: 'contact.html',
            content: content,
            layoutClass: 'flex flex-col min-h-screen',
            mainClass: 'container mx-auto px-6 flex-grow'
        };

        return this.buildPage(pageConfig);
    }

    /**
     * Build all pages
     */
    buildAll() {
        const pages = {
            'home.html': this.generateHomePage(),
            'work.html': this.generateWorkPage(),
            'certifications.html': this.generateCertificationsPage(),
            'contact.html': this.generateContactPage()
        };

        Object.entries(pages).forEach(([filename, content]) => {
            const outputPath = path.join(this.outputDir, filename);
            fs.writeFileSync(outputPath, content, 'utf8');
            console.log(`‚úÖ Generated: ${filename}`);
        });

        console.log('\nüéâ All pages generated successfully!');
        console.log('\nModular structure:');
        console.log('üìÅ components/ - Reusable HTML components');
        console.log('üìÅ config/ - Site configuration');
        console.log('üìÅ css/ - Component styles');
        console.log('üìÅ js/ - Component logic');
        console.log('üìÅ build/ - Build tools');
    }
}

// Run the builder
if (require.main === module) {
    const builder = new PageBuilder();
    builder.buildAll();
}

module.exports = PageBuilder;